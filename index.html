<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Emirates Connect Pro - Smart Connection Time Calculator for Dubai International Airport">
    <title>Emirates Connect Pro | Connection Time Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Emirates Brand Colors */
            --emirates-red: #D71921;
            --emirates-gold: #FFC72C;
            --emirates-dark-red: #A5141A;
            --emirates-light-red: rgba(215, 25, 33, 0.08);
            --emirates-blue: #0066CC;
            --emirates-light: #FFFFFF;
            
            /* Success Colors */
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            
            /* Light Theme */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8FAFC;
            --bg-tertiary: #F1F5F9;
            --surface: #FFFFFF;
            --surface-alt: #F8FAFC;
            
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-tertiary: #94A3B8;
            
            --border: #E2E8F0;
            --border-hover: #CBD5E1;
            
            /* Dark Theme */
            --dark-bg-primary: #0F172A;
            --dark-bg-secondary: #1E293B;
            --dark-bg-tertiary: #334155;
            --dark-surface: #1E293B;
            --dark-surface-alt: #334155;
            
            --dark-text-primary: #F1F5F9;
            --dark-text-secondary: #CBD5E1;
            --dark-text-tertiary: #94A3B8;
            
            --dark-border: #475569;
            --dark-border-hover: #64748B;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            
            /* Typography */
            --font-primary: 'Inter', sans-serif;
            --font-heading: 'Plus Jakarta Sans', sans-serif;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            transition: var(--transition-slow);
            overflow-x: hidden;
        }

        body.dark-mode {
            background: linear-gradient(135deg, var(--dark-bg-primary) 0%, var(--dark-bg-secondary) 100%);
            color: var(--dark-text-primary);
        }

        body.arabic {
            font-family: 'Tajawal', sans-serif;
            direction: rtl;
        }

        /* Accessibility: Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .arrow-circle {
                animation: none !important;
            }
            
            .emirates-logo {
                animation: none !important;
            }
        }

        /* Container */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Header */
        header {
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        body.dark-mode header {
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid var(--dark-border);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 16px;
            text-decoration: none;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .emirates-logo {
            width: 48px;
            height: 48px;
            position: relative;
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-dark-red) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            padding: 8px;
        }

        .emirates-logo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-dark-red) 100%);
            opacity: 0.9;
        }

        .logo-text {
            position: relative;
            z-index: 1;
            font-weight: 800;
            color: white;
            font-size: 14px;
            text-align: center;
            line-height: 1.2;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            width: 32px;
        }

        .emirates-logo .arabic-text {
            display: none;
        }

        body.arabic .emirates-logo .english-text {
            display: none;
        }

        body.arabic .emirates-logo .arabic-text {
            display: block;
        }

        .logo-text-content {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-size: 22px;
            font-weight: 700;
            font-family: var(--font-heading);
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-subtitle {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            letter-spacing: 0.5px;
        }

        body.dark-mode .logo-subtitle {
            color: var(--dark-text-secondary);
        }

        /* Controls */
        .controls {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* Modern Toggle */
        .toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            background: var(--surface-alt);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        body.dark-mode .toggle-wrapper {
            background: var(--dark-surface-alt);
            border-color: var(--dark-border);
        }

        .toggle-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            user-select: none;
        }

        body.dark-mode .toggle-label {
            color: var(--dark-text-secondary);
        }

        .modern-toggle {
            position: relative;
            width: 52px;
            height: 28px;
        }

        .modern-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-track {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            transition: var(--transition);
            border-radius: 50px;
        }

        .modern-toggle input:checked + .toggle-track {
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-blue) 100%);
        }

        .toggle-thumb {
            position: absolute;
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: var(--transition);
            border-radius: 50%;
            box-shadow: var(--shadow-md);
        }

        .modern-toggle input:checked + .toggle-track .toggle-thumb {
            transform: translateX(24px);
        }

        /* Control Buttons */
        .control-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--surface-alt);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            white-space: nowrap;
        }

        body.dark-mode .control-btn {
            background: var(--dark-surface-alt);
            border-color: var(--dark-border);
            color: var(--dark-text-secondary);
        }

        .control-btn:hover {
            background: var(--emirates-red);
            border-color: var(--emirates-red);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .control-btn:focus {
            outline: 3px solid var(--emirates-gold);
            outline-offset: 2px;
        }

        /* Hero Section */
        .hero {
            padding: 60px 0 40px;
            text-align: center;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            font-family: var(--font-heading);
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 40px;
            line-height: 1.6;
        }

        body.dark-mode .hero-subtitle {
            color: var(--dark-text-secondary);
        }

        /* Calculator Container */
        .calculator-container {
            background: var(--surface);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        body.dark-mode .calculator-container {
            background: var(--dark-surface);
            border-color: var(--dark-border);
        }

        .calculator-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        body.dark-mode .calculator-header {
            border-bottom-color: var(--dark-border);
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            font-family: var(--font-heading);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        body.dark-mode .section-title {
            color: var(--dark-text-primary);
        }

        /* Flight Sections */
        .flight-sections {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        @media (max-width: 1024px) {
            .flight-sections {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }

        .flight-card {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 32px;
            border: 2px solid transparent;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .flight-card {
            background: var(--dark-bg-tertiary);
        }

        .flight-card:hover {
            border-color: var(--emirates-light-red);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .flight-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-blue) 100%);
        }

        .flight-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        body.dark-mode .flight-card-title {
            color: var(--dark-text-primary);
        }

        /* Connection Arrow */
        .connection-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 60px;
        }

        .arrow-circle {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-blue) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: var(--shadow-lg);
            animation: pulse 2s infinite;
            transition: var(--transition);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Form Elements */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.dark-mode .form-label {
            color: var(--dark-text-secondary);
        }

        .form-label i {
            color: var(--emirates-red);
            font-size: 16px;
        }

        /* Fixed select styling for dark mode */
        .modern-select, .modern-input {
            padding: 14px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            transition: var(--transition);
            font-family: inherit;
            outline: none;
            /* Remove default arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        body.dark-mode .modern-select,
        body.dark-mode .modern-input {
            background: var(--dark-bg-secondary);
            border-color: var(--dark-border);
            color: var(--dark-text-primary);
        }

        /* Focus styles for accessibility */
        .modern-select:focus, .modern-input:focus {
            border-color: var(--emirates-red);
            box-shadow: 0 0 0 3px rgba(215, 25, 33, 0.1);
            outline: 3px solid var(--emirates-gold);
            outline-offset: 2px;
        }

        /* Custom select arrow - FIXED for dark mode */
        .modern-select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2364748B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
            padding-right: 44px;
        }

        body.dark-mode .modern-select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23CBD5E1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        }

        /* Time Inputs */
        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Calculate Button */
        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-blue) 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-family: var(--font-heading);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .calculate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition-slow);
        }

        .calculate-btn:hover::before {
            left: 100%;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .calculate-btn:focus {
            outline: 3px solid var(--emirates-gold);
            outline-offset: 3px;
        }

        /* Loading State */
        .calculate-btn.loading {
            pointer-events: none;
            opacity: 0.8;
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error Messages */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            color: var(--danger);
            font-weight: 600;
            display: none;
        }

        body.dark-mode .error-message {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Result Section */
        .result-container {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 32px;
            margin-top: 32px;
            border: 2px solid transparent;
            transition: var(--transition-slow);
            opacity: 0;
            transform: translateY(20px);
            max-height: 0;
            overflow: hidden;
        }

        body.dark-mode .result-container {
            background: var(--dark-bg-tertiary);
        }

        .result-container.show {
            opacity: 1;
            transform: translateY(0);
            max-height: 1000px;
            border-color: var(--emirates-light-red);
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .result-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .misconnected .result-icon {
            background: linear-gradient(135deg, var(--danger) 0%, #FF6B6B 100%);
        }

        .noshow .result-icon {
            background: linear-gradient(135deg, var(--success) 0%, #34D399 100%);
        }

        .result-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        body.dark-mode .result-title {
            color: var(--dark-text-primary);
        }

        /* Result Actions */
        .result-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Result Stats */
        .result-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .result-stats {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 16px;
            border-left: 4px solid var(--emirates-red);
            transition: var(--transition);
        }

        body.dark-mode .stat-card {
            background: var(--dark-bg-secondary);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        body.dark-mode .stat-label {
            color: var(--dark-text-secondary);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            font-family: var(--font-heading);
            color: var(--text-primary);
        }

        body.dark-mode .stat-value {
            color: var(--dark-text-primary);
        }

        /* Result Message */
        .result-message {
            padding: 20px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            background: var(--bg-primary);
            border: 2px solid;
            transition: var(--transition);
        }

        body.dark-mode .result-message {
            background: var(--dark-bg-secondary);
        }

        .misconnected .result-message {
            color: var(--danger);
            border-color: rgba(239, 68, 68, 0.2);
            background: rgba(239, 68, 68, 0.05);
        }

        body.dark-mode .misconnected .result-message {
            background: rgba(239, 68, 68, 0.1);
        }

        .noshow .result-message {
            color: var(--success);
            border-color: rgba(16, 185, 129, 0.2);
            background: rgba(16, 185, 129, 0.05);
        }

        body.dark-mode .noshow .result-message {
            background: rgba(16, 185, 129, 0.1);
        }

        /* Calculation History */
        .history-section {
            background: var(--surface);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        body.dark-mode .history-section {
            background: var(--dark-surface);
            border-color: var(--dark-border);
        }

        .history-list {
            margin-top: 24px;
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        body.dark-mode .history-item {
            background: var(--dark-bg-tertiary);
            border-color: var(--dark-border);
        }

        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .history-time {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .history-result {
            font-weight: 600;
            color: var(--emirates-red);
        }

        .history-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 8px;
            font-size: 14px;
        }

        .clear-history {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 16px;
            transition: var(--transition);
        }

        .clear-history:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Rules Section */
        .rules-section {
            background: var(--surface);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        body.dark-mode .rules-section {
            background: var(--dark-surface);
            border-color: var(--dark-border);
        }

        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .rule-card {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: help;
        }

        body.dark-mode .rule-card {
            background: var(--dark-bg-tertiary);
            border-color: var(--dark-border);
        }

        .rule-card:hover {
            transform: translateY(-2px);
            border-color: var(--emirates-red);
            box-shadow: var(--shadow-md);
        }

        .rule-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-blue) 100%);
        }

        /* Tooltip Styles */
        .rule-card::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 1000;
            pointer-events: none;
            max-width: 300px;
            text-align: center;
        }

        .rule-card:hover::after {
            opacity: 1;
            visibility: visible;
        }

        body.dark-mode .rule-card::after {
            background: var(--dark-text-primary);
            color: var(--dark-bg-primary);
        }

        .rule-time {
            font-size: 32px;
            font-weight: 800;
            font-family: var(--font-heading);
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            line-height: 1;
        }

        .rule-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        body.dark-mode .rule-desc {
            color: var(--dark-text-secondary);
        }

        /* Bay-Gate Mapping Section */
        .mapping-section {
            background: var(--surface);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        body.dark-mode .mapping-section {
            background: var(--dark-surface);
            border-color: var(--dark-border);
        }

        .mapping-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        body.dark-mode .mapping-header {
            border-bottom-color: var(--dark-border);
        }

        .mapping-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
            margin-top: 8px;
        }

        body.dark-mode .mapping-subtitle {
            color: var(--dark-text-secondary);
        }

        /* Mapping Table Container */
        .mapping-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            overflow-x: auto;
            transition: var(--transition);
        }

        body.dark-mode .mapping-container {
            background: var(--dark-bg-tertiary);
        }

        /* Mapping Table */
        .mapping-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 800px;
        }

        .mapping-table th {
            background: var(--emirates-red);
            color: white;
            font-weight: 600;
            padding: 16px;
            text-align: center;
            position: relative;
        }

        .mapping-table th:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 60%;
            width: 1px;
            background: rgba(255, 255, 255, 0.3);
        }

        .mapping-table th:first-child {
            border-top-left-radius: 12px;
        }

        .mapping-table th:last-child {
            border-top-right-radius: 12px;
        }

        .mapping-table td {
            padding: 14px 16px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            font-weight: 500;
            transition: var(--transition);
        }

        body.dark-mode .mapping-table td {
            border-bottom: 1px solid var(--dark-border);
        }

        .mapping-table tbody tr:hover td {
            background: var(--emirates-light-red);
        }

        body.dark-mode .mapping-table tbody tr:hover td {
            background: rgba(215, 25, 33, 0.2);
        }

        .concourse-header {
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-dark-red) 100%) !important;
            font-size: 18px;
            font-weight: 700;
        }

        .gate-cell {
            font-weight: 700;
            color: var(--emirates-red);
        }

        body.dark-mode .gate-cell {
            color: #FF8A8A;
        }

        /* Footer */
        footer {
            padding: 40px 0;
            margin-top: 40px;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-secondary);
        }

        body.dark-mode footer {
            border-top-color: var(--dark-border);
            color: var(--dark-text-secondary);
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .footer-logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--emirates-red) 0%, var(--emirates-dark-red) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 800;
            box-shadow: var(--shadow-sm);
        }

        .footer-text {
            font-size: 14px;
            margin-bottom: 8px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .controls {
                width: 100%;
                justify-content: center;
                gap: 12px;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .calculator-container,
            .rules-section,
            .mapping-section,
            .history-section {
                padding: 24px;
            }
            
            .flight-card {
                padding: 24px;
            }
            
            .result-actions {
                justify-content: center;
            }
            
            .history-details {
                grid-template-columns: 1fr;
            }
            
            .mapping-table {
                min-width: 600px;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .toggle-wrapper {
                width: 100%;
                justify-content: space-between;
            }
            
            .logo-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .rules-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        body.dark-mode ::-webkit-scrollbar-track {
            background: var(--dark-bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--emirates-red);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--emirates-dark-red);
        }

        /* Print Styles */
        @media print {
            .controls,
            .calculate-btn,
            .result-actions,
            .clear-history {
                display: none !important;
            }
            
            .result-container {
                break-inside: avoid;
                border: 2px solid #000 !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            .calculator-container,
            .rules-section,
            .history-section,
            .mapping-section {
                box-shadow: none !important;
                border: 1px solid #000 !important;
                background: white !important;
            }
            
            .hero-title {
                -webkit-text-fill-color: black !important;
            }
        }

        /* Emirates Logo Animation */
        @keyframes emiratesGlow {
            0%, 100% { 
                box-shadow: 0 0 10px rgba(215, 25, 33, 0.5),
                           var(--shadow-md);
            }
            50% { 
                box-shadow: 0 0 20px rgba(215, 25, 33, 0.8),
                           0 8px 25px rgba(215, 25, 33, 0.3);
            }
        }

        .emirates-logo {
            animation: emiratesGlow 3s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo-container">
                    <div class="emirates-logo">
                        <div class="logo-text">
                            <span class="english-text">EK</span>
                            <span class="arabic-text" style="display: none;">الإمارات</span>
                        </div>
                    </div>
                    <div class="logo-text-content">
                        <div class="logo-title en-text">Emirates Connect Pro</div>
                        <div class="logo-title ar-text" style="display: none;">الإمارات كونكت برو</div>
                        <div class="logo-subtitle en-text">Smart Connection Calculator</div>
                        <div class="logo-subtitle ar-text" style="display: none;">حاسبة التوصيل الذكية</div>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="toggle-wrapper">
                        <span class="toggle-label en-text">Dark Mode</span>
                        <span class="toggle-label ar-text" style="display: none;">الوضع المظلم</span>
                        <label class="modern-toggle">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-track">
                                <span class="toggle-thumb"></span>
                            </span>
                        </label>
                    </div>
                    
                    <button class="control-btn" id="langToggle">
                        <i class="fas fa-language"></i>
                        <span class="en-text">العربية</span>
                        <span class="ar-text" style="display: none;">English</span>
                    </button>
                    
                    <button class="control-btn" id="printBtn">
                        <i class="fas fa-print"></i>
                        <span class="en-text">Print</span>
                        <span class="ar-text" style="display: none;">طباعة</span>
                    </button>
                    
                    <button class="control-btn" id="shareBtn">
                        <i class="fas fa-share-alt"></i>
                        <span class="en-text">Share</span>
                        <span class="ar-text" style="display: none;">مشاركة</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Hero -->
        <section class="hero">
            <h1 class="hero-title en-text">Emirates Connect Pro</h1>
            <h1 class="hero-title ar-text" style="display: none;">الإمارات كونكت برو</h1>
            <p class="hero-subtitle en-text">
                Calculate exact connection times between flights at Dubai International Airport. 
                Avoid missed connections with our precise calculator.
            </p>
            <p class="hero-subtitle ar-text" style="display: none;">
                احسب أوقات التوصيل الدقيقة بين الرحلات في مطار دبي الدولي.
                تجنب الاتصالات الفائتة مع حاسبتنا الدقيقة.
            </p>
        </section>

        <!-- Calculator -->
        <div class="calculator-container">
            <div class="calculator-header">
                <h2 class="section-title">
                    <i class="fas fa-calculator"></i>
                    <span class="en-text">Connection Calculator</span>
                    <span class="ar-text" style="display: none;">حاسبة التوصيل</span>
                </h2>
            </div>

            <!-- Error Message Container -->
            <div class="error-message" id="errorMessage"></div>

            <!-- Flight Sections -->
            <div class="flight-sections">
                <!-- Arrival Flight -->
                <div class="flight-card">
                    <h3 class="flight-card-title">
                        <i class="fas fa-plane-arrival"></i>
                        <span class="en-text">Arrival Flight</span>
                        <span class="ar-text" style="display: none;">رحلة الوصول</span>
                    </h3>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-plane"></i>
                                <span class="en-text">Airline</span>
                                <span class="ar-text" style="display: none;">شركة الطيران</span>
                            </label>
                            <select id="arrivalAirline" class="modern-select">
                                <option value="emirates">Emirates</option>
                                <option value="aircanada">Air Canada</option>
                                <option value="united">United Airlines</option>
                                <option value="other">Other Airlines</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-terminal"></i>
                                <span class="en-text">Terminal</span>
                                <span class="ar-text" style="display: none;">المبنى</span>
                            </label>
                            <select id="arrivalTerminal" class="modern-select">
                                <option value="terminal3">Terminal 3</option>
                                <option value="terminal2">Terminal 2</option>
                                <option value="terminal1">Terminal 1</option>
                                <option value="remote">Remote Arrivals</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-building"></i>
                                <span class="en-text">Concourse</span>
                                <span class="ar-text" style="display: none;">الصالة</span>
                            </label>
                            <select id="arrivalConcourse" class="modern-select">
                                <option value="concourseA">Concourse A</option>
                                <option value="concourseB">Concourse B</option>
                                <option value="concourseC">Concourse C</option>
                                <option value="none">Not Applicable</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-calendar-day"></i>
                                <span class="en-text">Arrival Date</span>
                                <span class="ar-text" style="display: none;">تاريخ الوصول</span>
                            </label>
                            <input type="date" id="arrivalDate" class="modern-input">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-clock"></i>
                                <span class="en-text">Arrival Time</span>
                                <span class="ar-text" style="display: none;">وقت الوصول</span>
                            </label>
                            <input type="time" id="arrivalTime" class="modern-input" value="10:00">
                        </div>
                    </div>
                </div>
                
                <!-- Connection Arrow -->
                <div class="connection-arrow">
                    <div class="arrow-circle">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </div>
                
                <!-- Departure Flight -->
                <div class="flight-card">
                    <h3 class="flight-card-title">
                        <i class="fas fa-plane-departure"></i>
                        <span class="en-text">Departure Flight</span>
                        <span class="ar-text" style="display: none;">رحلة المغادرة</span>
                    </h3>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-plane"></i>
                                <span class="en-text">Airline</span>
                                <span class="ar-text" style="display: none;">شركة الطيران</span>
                            </label>
                            <select id="departureAirline" class="modern-select">
                                <option value="emirates">Emirates</option>
                                <option value="aircanada">Air Canada</option>
                                <option value="united">United Airlines</option>
                                <option value="other">Other Airlines</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-terminal"></i>
                                <span class="en-text">Terminal</span>
                                <span class="ar-text" style="display: none;">المبنى</span>
                            </label>
                            <select id="departureTerminal" class="modern-select">
                                <option value="terminal3">Terminal 3</option>
                                <option value="terminal2">Terminal 2</option>
                                <option value="terminal1">Terminal 1</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-building"></i>
                                <span class="en-text">Concourse</span>
                                <span class="ar-text" style="display: none;">الصالة</span>
                            </label>
                            <select id="departureConcourse" class="modern-select">
                                <option value="concourseA">Concourse A</option>
                                <option value="concourseB">Concourse B</option>
                                <option value="concourseC">Concourse C</option>
                                <option value="none">Not Applicable</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-calendar-day"></i>
                                <span class="en-text">Departure Date</span>
                                <span class="ar-text" style="display: none;">تاريخ المغادرة</span>
                            </label>
                            <input type="date" id="departureDate" class="modern-input">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-clock"></i>
                                <span class="en-text">Departure Time</span>
                                <span class="ar-text" style="display: none;">وقت المغادرة</span>
                            </label>
                            <input type="time" id="departureTime" class="modern-input" value="11:30">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calculate Button -->
            <button id="calculateBtn" class="calculate-btn">
                <i class="fas fa-bolt"></i>
                <span class="en-text">Calculate Connection Time</span>
                <span class="ar-text" style="display: none;">احسب وقت التوصيل</span>
            </button>

            <!-- Result Container -->
            <div class="result-container" id="resultContainer">
                <div class="result-header">
                    <div class="result-icon" id="resultIcon">
                        <i class="fas fa-plane"></i>
                    </div>
                    <div>
                        <h3 class="result-title" id="resultTitle">Connection Result</h3>
                        <p id="resultSubtitle" style="color: var(--text-secondary);"></p>
                    </div>
                </div>
                
                <div class="result-stats">
                    <div class="stat-card">
                        <div class="stat-label en-text">Actual Connection Time</div>
                        <div class="stat-label ar-text" style="display: none;">الوقت الفعلي للتوصيل</div>
                        <div class="stat-value" id="actualTime">0 min</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label en-text">Required Minimum</div>
                        <div class="stat-label ar-text" style="display: none;">الحد الأدنى المطلوب</div>
                        <div class="stat-value" id="requiredTime">0 min</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label en-text">Time Difference</div>
                        <div class="stat-label ar-text" style="display: none;">فرق الوقت</div>
                        <div class="stat-value" id="timeDifference">0 min</div>
                    </div>
                </div>
                
                <div class="result-message" id="resultMessage">
                    <!-- Message will be inserted here -->
                </div>
                
                <!-- Result Actions -->
                <div class="result-actions">
                    <button class="control-btn" id="saveResultBtn">
                        <i class="fas fa-save"></i>
                        <span class="en-text">Save Result</span>
                        <span class="ar-text" style="display: none;">حفظ النتيجة</span>
                    </button>
                    <button class="control-btn" id="copyResultBtn">
                        <i class="fas fa-copy"></i>
                        <span class="en-text">Copy Result</span>
                        <span class="ar-text" style="display: none;">نسخ النتيجة</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Calculation History -->
        <div class="history-section">
            <h2 class="section-title">
                <i class="fas fa-history"></i>
                <span class="en-text">Calculation History</span>
                <span class="ar-text" style="display: none;">سجل الحسابات</span>
            </h2>
            
            <div class="history-list" id="historyList">
                <!-- History items will be loaded here -->
                <div class="history-empty en-text" style="text-align: center; padding: 40px; color: var(--text-tertiary);">
                    No calculations yet. Start by calculating your first connection!
                </div>
                <div class="history-empty ar-text" style="display: none; text-align: center; padding: 40px; color: var(--text-tertiary);">
                    لا توجد حسابات حتى الآن. ابدأ بحساب أول توصيل لك!
                </div>
            </div>
            
            <button class="clear-history" id="clearHistoryBtn">
                <i class="fas fa-trash"></i>
                <span class="en-text">Clear History</span>
                <span class="ar-text" style="display: none;">مسح السجل</span>
            </button>
        </div>

        <!-- Rules Section -->
        <div class="rules-section">
            <h2 class="section-title">
                <i class="fas fa-list-check"></i>
                <span class="en-text">Connection Time Rules</span>
                <span class="ar-text" style="display: none;">قواعد وقت التوصيل</span>
            </h2>
            
            <div class="rules-grid">
                <!-- Rule 1 -->
                <div class="rule-card" data-tooltip="Applies to all Emirates flights within the same concourse">
                    <div class="rule-time">60 min</div>
                    <div class="rule-desc en-text">
                        Emirates to Emirates same concourse, Concourse A to Concourse B and Vice Versa, 
                        and Concourse B to Concourse C and Vice versa
                    </div>
                    <div class="rule-desc ar-text" style="display: none;">
                        الإمارات إلى الإمارات نفس الصالة، الصالة أ إلى الصالة ب والعكس، 
                        والصالة ب إلى الصالة ج والعكس
                    </div>
                </div>
                
                <!-- Rule 2 -->
                <div class="rule-card" data-tooltip="For remote parking stands arriving to main concourses">
                    <div class="rule-time">70 min</div>
                    <div class="rule-desc en-text">
                        Emirates Remote Arrivals to Concourse A/B/C
                    </div>
                    <div class="rule-desc ar-text" style="display: none;">
                        وصول الإمارات البعيدة إلى الصالات أ/ب/ج
                    </div>
                </div>
                
                <!-- Rule 3 -->
                <div class="rule-card" data-tooltip="Longer transfer time between A and C concourses">
                    <div class="rule-time">70 min</div>
                    <div class="rule-desc en-text">
                        Emirates Concourse A to Concourse C and vice versa
                    </div>
                    <div class="rule-desc ar-text" style="display: none;">
                        الإمارات الصالة أ إلى الصالة ج والعكس
                    </div>
                </div>
                
                <!-- Rule 4 -->
                <div class="rule-card" data-tooltip="Emirates and Air Canada interline connections">
                    <div class="rule-time">75 min</div>
                    <div class="rule-desc en-text">
                        Emirates to Air Canada and vice versa
                    </div>
                    <div class="rule-desc ar-text" style="display: none;">
                        الإمارات إلى طيران كندا والعكس
                    </div>
                </div>
                
                <!-- Rule 5 -->
                <div class="rule-card" data-tooltip="Emirates and United Airlines connections">
                    <div class="rule-time">90 min</div>
                    <div class="rule-desc en-text">
                        Emirates to United Airlines and vice versa
                    </div>
                    <div class="rule-desc ar-text" style="display: none;">
                        الإمارات إلى الخطوط الجوية المتحدة والعكس
                    </div>
                </div>
                
                <!-- Rule 6 -->
                <div class="rule-card" data-tooltip="Emirates and Fly Dubai FZ1 series connections">
                    <div class="rule-time">90 min</div>
                    <div class="rule-desc en-text">
                        Emirates to Fly Dubai (FZ1 Series) and vice versa
                    </div>
                    <div class="rule-desc ar-text" style="display: none;">
                        الإمارات إلى فلاي دبي (سلسلة FZ1) والعكس
                    </div>
                </div>
                
                <!-- Rule 7 -->
                <div class="rule-card" data-tooltip="Terminal 3 to Terminal 1 transfers">
                    <div class="rule-time">90 min</div>
                    <div class="rule-desc en-text">
                        Emirates Terminal 3 to other airlines Terminal 1 and vice versa
                    </div>
                    <div class="rule-desc ar-text" style="display: none;">
                        الإمارات المبنى 3 إلى شركات طيران أخرى المبنى 1 والعكس
                    </div>
                </div>
                
                <!-- Rule 8 -->
                <div class="rule-card" data-tooltip="Terminal 3 to Terminal 2 transfers (excluding FZ1 from T3)">
                    <div class="rule-time">120 min</div>
                    <div class="rule-desc en-text">
                        Emirates Terminal 3 to Flydubai/other airlines Terminal 2 and vice versa 
                        (FZ1 series operated from Terminal 3 excluded)
                    </div>
                    <div class="rule-desc ar-text" style="display: none;">
                        الإمارات المبنى 3 إلى فلاي دبي/شركات طيران أخرى المبنى 2 والعكس 
                        (سلسلة FZ1 المشغلة من المبنى 3 مستبعدة)
                    </div>
                </div>
            </div>
        </div>

        <!-- Bay-Gate Mapping Section (Moved to bottom) -->
        <div class="mapping-section">
            <div class="mapping-header">
                <div>
                    <h2 class="section-title">
                        <i class="fas fa-map-signs"></i>
                        <span class="en-text">Bay-Gate Reference</span>
                        <span class="ar-text" style="display: none;">مرجع الممرات والأبواب</span>
                    </h2>
                    <p class="mapping-subtitle en-text">Complete bay to gate mappings for Concourse A, B, and C</p>
                    <p class="mapping-subtitle ar-text" style="display: none;">خرائط كاملة للممرات للأبواب في الصالات أ، ب، ج</p>
                </div>
            </div>
            
            <!-- Mapping Table -->
            <div class="mapping-container">
                <table class="mapping-table">
                    <thead>
                        <tr>
                            <th colspan="2" class="concourse-header">Concourse A</th>
                            <th colspan="2" class="concourse-header">Concourse B</th>
                            <th colspan="2" class="concourse-header">Concourse C</th>
                        </tr>
                        <tr>
                            <th>BAY</th>
                            <th>GATE</th>
                            <th>BAY</th>
                            <th>GATE</th>
                            <th>BAY</th>
                            <th>GATE</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Row 1 -->
                        <tr>
                            <td>A1</td>
                            <td class="gate-cell">A5</td>
                            <td>B14</td>
                            <td class="gate-cell">B6</td>
                            <td>B1</td>
                            <td class="gate-cell">C2</td>
                        </tr>
                        <!-- Row 2 -->
                        <tr>
                            <td>A2</td>
                            <td class="gate-cell">A4</td>
                            <td>B15</td>
                            <td class="gate-cell">B8</td>
                            <td>B2</td>
                            <td class="gate-cell">C4</td>
                        </tr>
                        <!-- Row 3 -->
                        <tr>
                            <td>A3</td>
                            <td class="gate-cell">A3</td>
                            <td>B16</td>
                            <td class="gate-cell">B10</td>
                            <td>B3</td>
                            <td class="gate-cell">C6</td>
                        </tr>
                        <!-- Row 4 -->
                        <tr>
                            <td>A4</td>
                            <td class="gate-cell">A2</td>
                            <td>B17</td>
                            <td class="gate-cell">B12</td>
                            <td>B4</td>
                            <td class="gate-cell">C8</td>
                        </tr>
                        <!-- Row 5 -->
                        <tr>
                            <td>A5</td>
                            <td class="gate-cell">A1</td>
                            <td>B18</td>
                            <td class="gate-cell">B14</td>
                            <td>B5</td>
                            <td class="gate-cell">C10</td>
                        </tr>
                        <!-- Row 6 -->
                        <tr>
                            <td>A6</td>
                            <td class="gate-cell">A24</td>
                            <td>B20</td>
                            <td class="gate-cell">B18</td>
                            <td>B6</td>
                            <td class="gate-cell">C12</td>
                        </tr>
                        <!-- Row 7 -->
                        <tr>
                            <td>A7</td>
                            <td class="gate-cell">A23</td>
                            <td>B21</td>
                            <td class="gate-cell">B20</td>
                            <td>B8</td>
                            <td class="gate-cell">C14</td>
                        </tr>
                        <!-- Row 8 -->
                        <tr>
                            <td>A8</td>
                            <td class="gate-cell">A22</td>
                            <td>B22</td>
                            <td class="gate-cell">B22</td>
                            <td>B9</td>
                            <td class="gate-cell">C16</td>
                        </tr>
                        <!-- Row 9 -->
                        <tr>
                            <td>A9</td>
                            <td class="gate-cell">A21</td>
                            <td>B23</td>
                            <td class="gate-cell">B24</td>
                            <td>B10</td>
                            <td class="gate-cell">C18</td>
                        </tr>
                        <!-- Row 10 -->
                        <tr>
                            <td>A10</td>
                            <td class="gate-cell">A20</td>
                            <td>B24</td>
                            <td class="gate-cell">B26</td>
                            <td>B11</td>
                            <td class="gate-cell">C20</td>
                        </tr>
                        <!-- Row 11 -->
                        <tr>
                            <td>D1</td>
                            <td class="gate-cell">A8</td>
                            <td>B25</td>
                            <td class="gate-cell">B28</td>
                            <td>B12</td>
                            <td class="gate-cell">C22</td>
                        </tr>
                        <!-- Row 12 -->
                        <tr>
                            <td>D2</td>
                            <td class="gate-cell">A9</td>
                            <td>B27</td>
                            <td class="gate-cell">B31</td>
                            <td>F2</td>
                            <td class="gate-cell">C1</td>
                        </tr>
                        <!-- Row 13 -->
                        <tr>
                            <td>D3</td>
                            <td class="gate-cell">A10</td>
                            <td>F17</td>
                            <td class="gate-cell">B11</td>
                            <td>F3</td>
                            <td class="gate-cell">C3</td>
                        </tr>
                        <!-- Row 14 -->
                        <tr>
                            <td>D4</td>
                            <td class="gate-cell">A11</td>
                            <td>F18</td>
                            <td class="gate-cell">B13</td>
                            <td>F4</td>
                            <td class="gate-cell">C5</td>
                        </tr>
                        <!-- Row 15 -->
                        <tr>
                            <td>D5</td>
                            <td class="gate-cell">A12</td>
                            <td>F19</td>
                            <td class="gate-cell">B15</td>
                            <td>F5</td>
                            <td class="gate-cell">C7</td>
                        </tr>
                        <!-- Row 16 -->
                        <tr>
                            <td>D6</td>
                            <td class="gate-cell">A13</td>
                            <td>F20</td>
                            <td class="gate-cell">B17</td>
                            <td>F6</td>
                            <td class="gate-cell">C9</td>
                        </tr>
                        <!-- Row 17 -->
                        <tr>
                            <td>D7</td>
                            <td class="gate-cell">A14</td>
                            <td>F21</td>
                            <td class="gate-cell">B19</td>
                            <td>F7</td>
                            <td class="gate-cell">C11</td>
                        </tr>
                        <!-- Row 18 -->
                        <tr>
                            <td>D8</td>
                            <td class="gate-cell">A15</td>
                            <td>F22</td>
                            <td class="gate-cell">B21</td>
                            <td>F8</td>
                            <td class="gate-cell">C13</td>
                        </tr>
                        <!-- Row 19 -->
                        <tr>
                            <td>D9</td>
                            <td class="gate-cell">A16</td>
                            <td>F23</td>
                            <td class="gate-cell">B23</td>
                            <td>F9</td>
                            <td class="gate-cell">C17</td>
                        </tr>
                        <!-- Row 20 -->
                        <tr>
                            <td>D10</td>
                            <td class="gate-cell">A17</td>
                            <td>F24</td>
                            <td class="gate-cell">B25</td>
                            <td>F10</td>
                            <td class="gate-cell">C19</td>
                        </tr>
                        <!-- Row 21 -->
                        <tr>
                            <td></td>
                            <td></td>
                            <td>F25</td>
                            <td class="gate-cell">B27</td>
                            <td>F12</td>
                            <td class="gate-cell">C21</td>
                        </tr>
                        <!-- Row 22 -->
                        <tr>
                            <td></td>
                            <td></td>
                            <td>F26</td>
                            <td class="gate-cell">B29</td>
                            <td>F13</td>
                            <td class="gate-cell">C23</td>
                        </tr>
                        <!-- Row 23 -->
                        <tr>
                            <td></td>
                            <td></td>
                            <td>F27</td>
                            <td class="gate-cell">B30</td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="footer-logo-icon">EK</div>
                    <div>
                        <p class="footer-text en-text">© 2024 Emirates Connect Pro. All calculations are for reference purposes only.</p>
                        <p class="footer-text ar-text" style="display: none;">© 2024 الإمارات كونكت برو. جميع الحسابات للاسترشاد فقط.</p>
                        <p style="font-size: 12px; opacity: 0.8;">
                            <span class="en-text">Always verify with official airline sources.</span>
                            <span class="ar-text" style="display: none;">تحقق دائمًا من المصادر الرسمية للخطوط الجوية.</span>
                        </p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Application State
        const AppState = {
            currentResult: null,
            calculationHistory: [],
            debounceTimer: null,
            isLoading: false
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates
            setDefaultDates();
            
            // Initialize dark mode
            initializeDarkMode();
            
            // Initialize language
            initializeLanguage();
            
            // Initialize event listeners
            initializeEventListeners();
            
            // Load calculation history
            loadCalculationHistory();
            
            // Initialize Intersection Observer for lazy loading
            initializeLazyLoading();
        });

        // Set default dates and times
        function setDefaultDates() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            
            document.getElementById('arrivalDate').value = formattedDate;
            document.getElementById('departureDate').value = formattedDate;
            
            // Set default departure time to 1.5 hours after arrival
            const arrivalTime = document.getElementById('arrivalTime').value;
            updateDepartureTime(arrivalTime);
        }

        // Update departure time based on arrival time
        function updateDepartureTime(arrivalTime) {
            const [arrivalHours, arrivalMinutes] = arrivalTime.split(':').map(Number);
            let departureHours = arrivalHours + 1;
            let departureMinutes = arrivalMinutes + 30;
            
            if (departureMinutes >= 60) {
                departureHours += 1;
                departureMinutes -= 60;
            }
            
            if (departureHours >= 24) {
                departureHours -= 24;
            }
            
            const formattedDepartureHours = departureHours.toString().padStart(2, '0');
            const formattedDepartureMinutes = departureMinutes.toString().padStart(2, '0');
            document.getElementById('departureTime').value = `${formattedDepartureHours}:${formattedDepartureMinutes}`;
        }

        // Dark Mode Functionality
        function initializeDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            
            // Check saved preference
            const savedDarkMode = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            // Set initial state
            if (savedDarkMode === 'true' || (savedDarkMode === null && prefersDark)) {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
            } else if (savedDarkMode === 'false') {
                document.body.classList.remove('dark-mode');
                darkModeToggle.checked = false;
            }
            
            // Add event listener
            darkModeToggle.addEventListener('change', function() {
                document.body.classList.toggle('dark-mode', this.checked);
                localStorage.setItem('darkMode', this.checked);
                updateSelectArrows();
            });
            
            updateSelectArrows();
        }

        // Fix select arrows in dark mode
        function updateSelectArrows() {
            const isDarkMode = document.body.classList.contains('dark-mode');
            const selects = document.querySelectorAll('.modern-select');
            
            selects.forEach(select => {
                select.style.backgroundImage = '';
                
                if (isDarkMode) {
                    select.style.backgroundImage = "url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23CBD5E1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\")";
                } else {
                    select.style.backgroundImage = "url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2364748B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\")";
                }
                
                select.style.backgroundRepeat = 'no-repeat';
                select.style.backgroundPosition = 'right 16px center';
                select.style.backgroundSize = '16px';
            });
        }

        // Language Functionality
        function initializeLanguage() {
            const langToggle = document.getElementById('langToggle');
            const savedLanguage = localStorage.getItem('language');
            
            if (savedLanguage === 'ar') {
                switchToArabic();
            }
            
            langToggle.addEventListener('click', function() {
                if (document.body.classList.contains('arabic')) {
                    switchToEnglish();
                } else {
                    switchToArabic();
                }
                updateSelectArrows();
            });
        }

        function switchToArabic() {
            document.body.classList.add('arabic');
            document.querySelectorAll('.en-text').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.ar-text').forEach(el => el.style.display = 'inline');
            document.querySelector('.emirates-logo .english-text').style.display = 'none';
            document.querySelector('.emirates-logo .arabic-text').style.display = 'block';
            localStorage.setItem('language', 'ar');
        }

        function switchToEnglish() {
            document.body.classList.remove('arabic');
            document.querySelectorAll('.en-text').forEach(el => el.style.display = 'inline');
            document.querySelectorAll('.ar-text').forEach(el => el.style.display = 'none');
            document.querySelector('.emirates-logo .english-text').style.display = 'block';
            document.querySelector('.emirates-logo .arabic-text').style.display = 'none';
            localStorage.setItem('language', 'en');
        }

        // Lazy Loading
        function initializeLazyLoading() {
            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('loaded');
                            observer.unobserve(entry.target);
                        }
                    });
                }, {
                    rootMargin: '50px',
                    threshold: 0.1
                });
                
                document.querySelectorAll('.rules-section, .history-section, .mapping-section').forEach(section => {
                    observer.observe(section);
                });
            }
        }

        // Event Listeners
        function initializeEventListeners() {
            // Calculate button
            document.getElementById('calculateBtn').addEventListener('click', calculateConnection);
            
            // Terminal changes
            document.getElementById('arrivalTerminal').addEventListener('change', updateConcourseOptions);
            document.getElementById('departureTerminal').addEventListener('change', updateConcourseOptions);
            
            // Time input debouncing
            document.getElementById('arrivalTime').addEventListener('input', function() {
                clearTimeout(AppState.debounceTimer);
                AppState.debounceTimer = setTimeout(() => {
                    updateDepartureTime(this.value);
                }, 300);
            });
            
            // Print button
            document.getElementById('printBtn').addEventListener('click', () => {
                window.print();
            });
            
            // Share button
            document.getElementById('shareBtn').addEventListener('click', shareApplication);
            
            // Result actions
            document.getElementById('saveResultBtn').addEventListener('click', saveResult);
            document.getElementById('copyResultBtn').addEventListener('click', copyResult);
            
            // Clear history
            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
        }

        // Update concourse options based on terminal
        function updateConcourseOptions() {
            const arrivalTerminal = document.getElementById('arrivalTerminal').value;
            const departureTerminal = document.getElementById('departureTerminal').value;
            const arrivalConcourse = document.getElementById('arrivalConcourse');
            const departureConcourse = document.getElementById('departureConcourse');
            
            const concourseOptions = `
                <option value="concourseA">Concourse A</option>
                <option value="concourseB">Concourse B</option>
                <option value="concourseC">Concourse C</option>
                <option value="none">Not Applicable</option>
            `;
            
            arrivalConcourse.innerHTML = arrivalTerminal === 'terminal3' ? concourseOptions : '<option value="none">Not Applicable</option>';
            departureConcourse.innerHTML = departureTerminal === 'terminal3' ? concourseOptions : '<option value="none">Not Applicable</option>';
            
            updateSelectArrows();
        }

        // Input Validation
        function validateInputs() {
            const arrivalDate = document.getElementById('arrivalDate').value;
            const departureDate = document.getElementById('departureDate').value;
            const arrivalTime = document.getElementById('arrivalTime').value;
            const departureTime = document.getElementById('departureTime').value;
            
            const errors = [];
            const isArabic = document.body.classList.contains('arabic');
            
            if (!arrivalDate || !departureDate) {
                errors.push(isArabic ? "الرجاء تحديد تاريخي الوصول والمغادرة" : "Please select both arrival and departure dates");
            }
            
            if (!arrivalTime || !departureTime) {
                errors.push(isArabic ? "الرجاء تحديد وقتي الوصول والمغادرة" : "Please select both arrival and departure times");
            }
            
            if (arrivalDate && departureDate && arrivalTime && departureTime) {
                const arrivalDateTime = new Date(`${arrivalDate}T${arrivalTime}`);
                const departureDateTime = new Date(`${departureDate}T${departureTime}`);
                
                if (departureDateTime <= arrivalDateTime) {
                    errors.push(isArabic ? "يجب أن يكون وقت المغادرة بعد وقت الوصول" : "Departure must be after arrival time");
                }
                
                // Check if connection time is unrealistic (more than 48 hours)
                const maxConnectionHours = 48;
                const maxConnectionMs = maxConnectionHours * 60 * 60 * 1000;
                if ((departureDateTime - arrivalDateTime) > maxConnectionMs) {
                    errors.push(isArabic ? `وقت التوصيل لا يمكن أن يتجاوز ${maxConnectionHours} ساعة` : `Connection time cannot exceed ${maxConnectionHours} hours`);
                }
                
                // Check if dates are too far in the past (more than 5 years)
                const now = new Date();
                const fiveYearsAgo = new Date();
                fiveYearsAgo.setFullYear(now.getFullYear() - 5);
                
                if (arrivalDateTime < fiveYearsAgo) {
                    errors.push(isArabic ? "تاريخ الوصول لا يمكن أن يكون قبل أكثر من 5 سنوات" : "Arrival date cannot be more than 5 years in the past");
                }
                
                if (departureDateTime < fiveYearsAgo) {
                    errors.push(isArabic ? "تاريخ المغادرة لا يمكن أن يكون قبل أكثر من 5 سنوات" : "Departure date cannot be more than 5 years in the past");
                }
                
                // Check if departure date is too far in the future (more than 2 years)
                const twoYearsFromNow = new Date();
                twoYearsFromNow.setFullYear(now.getFullYear() + 2);
                
                if (departureDateTime > twoYearsFromNow) {
                    errors.push(isArabic ? "تاريخ المغادرة لا يمكن أن يكون بعد أكثر من سنتين" : "Departure date cannot be more than 2 years in the future");
                }
            }
            
            return errors;
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            // Hide error after 5 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Loading state
        function showLoading() {
            if (AppState.isLoading) return;
            
            AppState.isLoading = true;
            const btn = document.getElementById('calculateBtn');
            const originalContent = btn.innerHTML;
            
            btn.classList.add('loading');
            btn.innerHTML = '<i class="fas fa-spinner spinner"></i> <span class="en-text">Calculating...</span><span class="ar-text" style="display: none;">جاري الحساب...</span>';
            btn.disabled = true;
            
            return () => {
                AppState.isLoading = false;
                btn.classList.remove('loading');
                btn.innerHTML = originalContent;
                btn.disabled = false;
            };
        }

        // Calculate connection time
        async function calculateConnection() {
            // Validate inputs
            const errors = validateInputs();
            if (errors.length > 0) {
                showError(errors[0]);
                return;
            }
            
            // Show loading
            const hideLoading = showLoading();
            
            try {
                // Simulate calculation delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Get input values
                const arrivalAirline = document.getElementById('arrivalAirline').value;
                const arrivalTerminal = document.getElementById('arrivalTerminal').value;
                const arrivalConcourse = document.getElementById('arrivalConcourse').value;
                const departureAirline = document.getElementById('departureAirline').value;
                const departureTerminal = document.getElementById('departureTerminal').value;
                const departureConcourse = document.getElementById('departureConcourse').value;
                const arrivalDate = document.getElementById('arrivalDate').value;
                const arrivalTime = document.getElementById('arrivalTime').value;
                const departureDate = document.getElementById('departureDate').value;
                const departureTime = document.getElementById('departureTime').value;
                
                // Calculate actual connecting time
                const arrivalDateTime = new Date(`${arrivalDate}T${arrivalTime}`);
                const departureDateTime = new Date(`${departureDate}T${departureTime}`);
                const actualConnectingTime = Math.round((departureDateTime - arrivalDateTime) / (1000 * 60));
                
                // Determine required connecting time based on rules
                let requiredTime = 0;
                let ruleDescription = "";
                
                // Rule 1: Emirates to Emirates same concourse, A to B/B to A, B to C/C to B
                if (arrivalAirline === 'emirates' && departureAirline === 'emirates' && 
                    arrivalTerminal === 'terminal3' && departureTerminal === 'terminal3') {
                    
                    if (arrivalConcourse === departureConcourse && arrivalConcourse !== 'none') {
                        requiredTime = 60;
                        ruleDescription = "Emirates to Emirates same concourse";
                    } else if (
                        (arrivalConcourse === 'concourseA' && departureConcourse === 'concourseB') ||
                        (arrivalConcourse === 'concourseB' && departureConcourse === 'concourseA') ||
                        (arrivalConcourse === 'concourseB' && departureConcourse === 'concourseC') ||
                        (arrivalConcourse === 'concourseC' && departureConcourse === 'concourseB')
                    ) {
                        requiredTime = 60;
                        ruleDescription = "Emirates Concourse A to B / B to A, or B to C / C to B";
                    }
                }
                
                // Rule 2: Emirates Remote Arrivals to Concourse A/B/C
                if (arrivalAirline === 'emirates' && departureAirline === 'emirates' && 
                    arrivalTerminal === 'remote' && departureTerminal === 'terminal3' &&
                    (departureConcourse === 'concourseA' || departureConcourse === 'concourseB' || departureConcourse === 'concourseC')) {
                    requiredTime = 70;
                    ruleDescription = "Emirates Remote Arrivals to Concourse A/B/C";
                }
                
                // Rule 3: Emirates Concourse A to Concourse C and vice versa
                if (arrivalAirline === 'emirates' && departureAirline === 'emirates' && 
                    arrivalTerminal === 'terminal3' && departureTerminal === 'terminal3' &&
                    ((arrivalConcourse === 'concourseA' && departureConcourse === 'concourseC') ||
                     (arrivalConcourse === 'concourseC' && departureConcourse === 'concourseA'))) {
                    requiredTime = 70;
                    ruleDescription = "Emirates Concourse A to Concourse C and vice versa";
                }
                
                // Rule 4: Emirates to Air Canada and vice versa
                if (
                    (arrivalAirline === 'emirates' && departureAirline === 'aircanada') ||
                    (arrivalAirline === 'aircanada' && departureAirline === 'emirates')
                ) {
                    requiredTime = 75;
                    ruleDescription = "Emirates to Air Canada and vice versa";
                }
                
                // Rule 5: Emirates to United Airlines and vice versa
                if (
                    (arrivalAirline === 'emirates' && departureAirline === 'united') ||
                    (arrivalAirline === 'united' && departureAirline === 'emirates')
                ) {
                    requiredTime = 90;
                    ruleDescription = "Emirates to United Airlines and vice versa";
                }
                
                // Rule 6: Emirates to Fly Dubai (FZ1 Series) and vice versa
                // Note: This rule is only for FZ1 series
                if (
                    (arrivalAirline === 'emirates' && departureAirline === 'other') ||
                    (arrivalAirline === 'other' && departureAirline === 'emirates')
                ) {
                    // For Fly Dubai FZ1 series, it would need additional detection
                    // For now, treat as general connection
                    requiredTime = 0; // Will fall back to default
                }
                
                // Rule 7: Emirates terminal 3 to other airlines terminal 1 and vice versa
                if (
                    (arrivalAirline === 'emirates' && arrivalTerminal === 'terminal3' && 
                     departureAirline === 'other' && departureTerminal === 'terminal1') ||
                    (arrivalAirline === 'other' && arrivalTerminal === 'terminal1' && 
                     departureAirline === 'emirates' && departureTerminal === 'terminal3')
                ) {
                    requiredTime = 90;
                    ruleDescription = "Emirates Terminal 3 to other airlines Terminal 1 and vice versa";
                }
                
                // Rule 8: Emirates terminal 3 to Flydubai/other airlines terminal 2 and vice versa
                if (
                    (arrivalAirline === 'emirates' && arrivalTerminal === 'terminal3' && 
                     departureAirline !== 'emirates' && departureTerminal === 'terminal2' &&
                     !(departureAirline === 'other' && arrivalTerminal === 'terminal3')) ||
                    (arrivalAirline !== 'emirates' && arrivalTerminal === 'terminal2' && 
                     departureAirline === 'emirates' && departureTerminal === 'terminal3' &&
                     !(arrivalAirline === 'other' && arrivalTerminal === 'terminal2'))
                ) {
                    requiredTime = 120;
                    ruleDescription = "Emirates Terminal 3 to other airlines Terminal 2 and vice versa";
                }
                
                // Default rule if no specific rule matches
                if (requiredTime === 0) {
                    requiredTime = 90;
                    ruleDescription = "General minimum connecting time";
                }
                
                // Store result
                AppState.currentResult = {
                    actualTime: actualConnectingTime,
                    requiredTime: requiredTime,
                    ruleDescription: ruleDescription,
                    timestamp: new Date().toISOString(),
                    arrivalAirline,
                    departureAirline,
                    arrivalTerminal,
                    departureTerminal
                };
                
                // Display result
                displayResult();
                
            } catch (error) {
                console.error('Calculation error:', error);
                const isArabic = document.body.classList.contains('arabic');
                showError(isArabic ? "حدث خطأ أثناء الحساب. الرجاء المحاولة مرة أخرى." : "An error occurred during calculation. Please try again.");
            } finally {
                hideLoading();
            }
        }

        // Display result
        function displayResult() {
            if (!AppState.currentResult) return;
            
            const { actualTime, requiredTime, ruleDescription } = AppState.currentResult;
            const isArabic = document.body.classList.contains('arabic');
            const resultContainer = document.getElementById('resultContainer');
            const resultIcon = document.getElementById('resultIcon');
            const resultTitle = document.getElementById('resultTitle');
            const resultSubtitle = document.getElementById('resultSubtitle');
            const actualTimeElement = document.getElementById('actualTime');
            const requiredTimeElement = document.getElementById('requiredTime');
            const timeDifferenceElement = document.getElementById('timeDifference');
            const resultMessage = document.getElementById('resultMessage');
            
            // Clear previous classes
            resultContainer.classList.remove('misconnected', 'noshow');
            
            if (actualTime < requiredTime) {
                // Misconnected passenger
                resultContainer.classList.add('misconnected');
                resultTitle.textContent = isArabic ? "راكب مفقود التوصيل" : "MISCONNECTED PASSENGER";
                resultSubtitle.textContent = ruleDescription;
                resultIcon.innerHTML = '<i class="fas fa-times"></i>';
                resultMessage.textContent = isArabic 
                    ? `الوقت الفعلي (${actualTime} دقيقة) أقل من الحد الأدنى المطلوب (${requiredTime} دقيقة)`
                    : `Actual time (${actualTime} min) is less than required minimum (${requiredTime} min)`;
            } else {
                // No show passenger (within the required time)
                resultContainer.classList.add('noshow');
                resultTitle.textContent = isArabic ? "راكب لم يحضر" : "NO SHOW PASSENGER";
                resultSubtitle.textContent = ruleDescription;
                resultIcon.innerHTML = '<i class="fas fa-check"></i>';
                resultMessage.textContent = isArabic
                    ? `الوقت الفعلي (${actualTime} دقيقة) يلبي أو يتجاوز الحد الأدنى المطلوب (${requiredTime} دقيقة)`
                    : `Actual time (${actualTime} min) meets or exceeds required minimum (${requiredTime} min)`;
            }
            
            // Update stats
            actualTimeElement.textContent = `${actualTime} min`;
            requiredTimeElement.textContent = `${requiredTime} min`;
            
            const timeDifference = Math.abs(actualTime - requiredTime);
            timeDifferenceElement.textContent = `${timeDifference} min`;
            
            // Show result with animation
            resultContainer.classList.add('show');
            
            // Scroll to result
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Save result to history
        function saveResult() {
            if (!AppState.currentResult) return;
            
            AppState.calculationHistory.unshift({...AppState.currentResult});
            
            // Keep only last 10 calculations
            if (AppState.calculationHistory.length > 10) {
                AppState.calculationHistory = AppState.calculationHistory.slice(0, 10);
            }
            
            // Save to localStorage
            localStorage.setItem('calculationHistory', JSON.stringify(AppState.calculationHistory));
            
            // Update history display
            updateHistoryDisplay();
            
            // Show confirmation
            const isArabic = document.body.classList.contains('arabic');
            alert(isArabic ? "تم حفظ النتيجة في السجل" : "Result saved to history");
        }

        // Copy result to clipboard
        async function copyResult() {
            if (!AppState.currentResult) return;
            
            const { actualTime, requiredTime } = AppState.currentResult;
            const isArabic = document.body.classList.contains('arabic');
            const status = document.querySelector('.result-title').textContent;
            const shareText = `Emirates Connect Pro Result:\n${status}\nActual: ${actualTime} min\nRequired: ${requiredTime} min`;
            
            try {
                await navigator.clipboard.writeText(shareText);
                alert(isArabic ? "تم نسخ النتيجة" : "Result copied to clipboard!");
            } catch (err) {
                console.error('Failed to copy:', err);
                alert(isArabic ? "فشل نسخ النتيجة" : "Failed to copy result");
            }
        }

        // Share application
        async function shareApplication() {
            const isArabic = document.body.classList.contains('arabic');
            const shareData = {
                title: 'Emirates Connect Pro',
                text: isArabic ? 'حاسبة التوصيل الذكية لمطار دبي الدولي' : 'Smart connection calculator for Dubai International Airport',
                url: window.location.href
            };
            
            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                } else {
                    // Fallback: copy URL to clipboard
                    await navigator.clipboard.writeText(window.location.href);
                    alert(isArabic ? 'تم نسخ الرابط' : 'Link copied to clipboard!');
                }
            } catch (err) {
                console.error('Share failed:', err);
            }
        }

        // Load calculation history
        function loadCalculationHistory() {
            const savedHistory = localStorage.getItem('calculationHistory');
            if (savedHistory) {
                AppState.calculationHistory = JSON.parse(savedHistory);
                updateHistoryDisplay();
            }
        }

        // Update history display
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            const isArabic = document.body.classList.contains('arabic');
            
            if (AppState.calculationHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="history-empty ${isArabic ? 'ar-text' : 'en-text'}" style="text-align: center; padding: 40px; color: var(--text-tertiary);">
                        ${isArabic ? 'لا توجد حسابات حتى الآن. ابدأ بحساب أول توصيل لك!' : 'No calculations yet. Start by calculating your first connection!'}
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = AppState.calculationHistory.map((item, index) => {
                const date = new Date(item.timestamp);
                const timeString = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const dateString = date.toLocaleDateString();
                const status = item.actualTime < item.requiredTime ? 
                    (isArabic ? 'مفقود التوصيل' : 'Misconnected') : 
                    (isArabic ? 'ناجح' : 'Successful');
                
                return `
                    <div class="history-item">
                        <div class="history-header">
                            <div class="history-result">${status}</div>
                            <div class="history-time">${dateString} ${timeString}</div>
                        </div>
                        <div class="history-details">
                            <div>${isArabic ? 'الوقت الفعلي' : 'Actual'}: ${item.actualTime} min</div>
                            <div>${isArabic ? 'المطلوب' : 'Required'}: ${item.requiredTime} min</div>
                            <div>${isArabic ? 'الفرق' : 'Difference'}: ${Math.abs(item.actualTime - item.requiredTime)} min</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Clear history
        function clearHistory() {
            const isArabic = document.body.classList.contains('arabic');
            if (confirm(isArabic ? 'هل أنت متأكد من مسح سجل الحسابات؟' : 'Are you sure you want to clear the calculation history?')) {
                AppState.calculationHistory = [];
                localStorage.removeItem('calculationHistory');
                updateHistoryDisplay();
            }
        }

        // Initialize concourse options
        updateConcourseOptions();
    </script>
</body>
</html>
